# Fine-tuned BGE Reranker: SPLADE + BGE with Query Rewriting
# Uses pedrovo9/bge-reranker-v2-m3-multirag-finetuned trained on multi-domain RAG data
# Expected: Improvement over generic BGE reranker on multi-turn queries

experiment:
  name: "finetune_bge_splade_bge15_rewrite"
  type: "retrieval"
  description: "Hybrid SPLADE + BGE-base-en-v1.5 with fine-tuned BGE reranker (pedrovo9)"

data:
  domains: ["clapnq", "cloud", "fiqa", "govt"]
  query_mode: "last_turn"
  query_file: "data/retrieval_tasks/{domain}/{domain}_rewrite.jsonl"
  qrels_file: "data/retrieval_tasks/{domain}/qrels/dev.tsv"
  corpus_path: "data/passage_level_processed/{domain}"

retrieval:
  type: "hybrid"
  fusion_method: "rrf"
  rrf_k: 60
  sparse:
    method: "splade"
    top_k: 300
  dense:
    method: "bge"
    model_name: "BAAI/bge-base-en-v1.5"
    top_k: 300

query_transform:
  enabled: false
  rewriter_type: "vllm"
  merge_strategy: "replace"
  rewriter_config:
    model_name: "Qwen/Qwen2.5-7B-Instruct"
    temperature: 0
    max_rewrites: 1
    max_tokens: 128
    retrieval_type: "dense"

reranking:
  enabled: true
  reranker_type: "finetuned_bge"
  model_name: "pedrovo9/bge-reranker-v2-m3-multirag-finetuned"
  top_k: 100
  batch_size: 32
  use_fp16: true

output:
  save_results: true
  results_dir: "experiments/{experiment_name}/{domain}"
  
metrics:
  compute: ["ndcg@5", "ndcg@10", "ndcg@20", "recall@5", "recall@10", "recall@20", "map@10", "precision@5"]
